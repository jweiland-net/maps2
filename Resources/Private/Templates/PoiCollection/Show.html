<html lang="en"
      xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:maps2="http://typo3.org/ns/JWeiland/Maps2/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Default"/>

<f:section name="main">
    <f:flashMessages/>
    <f:flashMessages queueIdentifier="extbase.flashmessages.maps2"/>

    <f:if condition="{settings.mapProvider} == 'gm'">
        <f:then>
            <f:comment><!-- What a dump solution to add the nonce attribute to all dynamically generated style tags by Google Maps API --></f:comment>
            <f:asset.css identifier="maps2-google-maps" useNonce="1" priority="1">;</f:asset.css>
            <f:asset.script identifier="maps2-google-maps-api"
                            src="https://maps.googleapis.com/maps/api/js?key={environment.settings.googleMapsJavaScriptApiKey}&libraries=places&callback=initMap"
                            async="0"
                            inline="0"
                            useNonce="1"/>
            <f:asset.script identifier="maps2-google-maps"
                            src="EXT:maps2/Resources/Public/JavaScript/GoogleMaps2.min.js"
                            async="0"
                            inline="0"
                            useNonce="1"/>
        </f:then>
        <f:else>
            <f:asset.css identifier="maps2-osm"
                         href="EXT:maps2/Resources/Public/Css/Leaflet/Leaflet.css"
                         inline="0"
                         useNonce="1"/>
            <f:asset.script identifier="maps2-osm-leaflet"
                            src="EXT:maps2/Resources/Public/JavaScript/leaflet.min.js"
                            async="0"
                            inline="0"
                            useNonce="1"/>
            <f:asset.script identifier="maps2-osm"
                            src="EXT:maps2/Resources/Public/JavaScript/OpenStreetMap2.min.js"
                            async="0"
                            inline="0"
                            useNonce="1"/>
        </f:else>
    </f:if>

    <div id="maps2-{data.uid}"
         class="maps2"
         data-environment="{environment -> maps2:convertToJson()}"
         data-pois="{poiCollections -> maps2:convertToJson()}"></div>
</f:section>
</html>
