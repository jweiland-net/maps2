var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},OpenStreetMap2=function(){function t(t,e){this.element=t,this.environment=e,this.allMarkers=[],this.categorizedMarkers={},this.bounds=new L.LatLngBounds([[e.extConf.defaultLatitude,e.extConf.defaultLongitude]]),this.editable=this.element.classList.contains("editMarker"),this.preparePoisCollections(),this.editable=this.element.classList.contains("editMarker"),this.setWidthAndHeight(),this.createMap(),this.mainProcess()}return t.prototype.preparePoisCollections=function(){this.poiCollections=JSON.parse(this.element.getAttribute("data-pois")||"[]")},t.prototype.mainProcess=function(){this.isPOICollectionsEmpty()?this.createMarkerBasedOnDataAttributes():this.createMarkerBasedOnPOICollections()},t.prototype.isPOICollectionsEmpty=function(){return"undefined"===this.poiCollections||0===this.poiCollections.length},t.prototype.createMarkerBasedOnDataAttributes=function(){var t=this.getAttributeAsFloat("data-latitude"),e=this.getAttributeAsFloat("data-longitude");isNaN(t)||isNaN(e)||this.createMarkerByLatLng(t,e)},t.prototype.getAttributeAsFloat=function(t){return parseFloat(this.element.getAttribute(t)||"")},t.prototype.createMarkerBasedOnPOICollections=function(){this.createPointByCollectionType(this.environment),1<this.countObjectProperties(this.categorizedMarkers)&&this.showSwitchableCategories(this.environment),this.adjustMapZoom()},t.prototype.adjustMapZoom=function(){this.shouldFitBounds()?this.map.fitBounds(this.bounds):this.map.panTo([this.poiCollections[0].latitude,this.poiCollections[0].longitude])},t.prototype.shouldFitBounds=function(){return!1===this.environment.settings.forceZoom&&(1<this.poiCollections.length||1===this.poiCollections.length&&("Area"===this.poiCollections[0].collectionType||"Route"===this.poiCollections[0].collectionType))},t.prototype.setWidthAndHeight=function(){this.element.style.height=this.normalizeDimension(this.environment.settings.mapHeight),this.element.style.width=this.normalizeDimension(this.environment.settings.mapWidth)},t.prototype.normalizeDimension=function(t){t=String(t);return this.canBeInterpretedAsNumber(t)&&(t+="px"),t},t.prototype.createMap=function(){this.map=L.map(this.element,{center:[this.getExtConf().defaultLatitude,this.getExtConf().defaultLongitude],zoom:this.getSettings().zoom?this.getSettings().zoom:12,editable:this.editable,scrollWheelZoom:"0"!==this.getSettings().activateScrollWheel}),L.tileLayer(this.getSettings().mapTile,{attribution:this.getSettings().mapTileAttribution,maxZoom:20}).addTo(this.map)},t.prototype.groupCategories=function(t){for(var e,o={},i=0;i<this.poiCollections.length;i++)for(var n=0;n<this.poiCollections[i].categories.length;n++)e=String(this.poiCollections[i].categories[n].uid),-1<this.inList(t.settings.categories,e)&&!o.hasOwnProperty(e)&&(o[e]=this.poiCollections[i].categories[n]);return o},t.prototype.getCategoriesOfCheckboxesWithStatus=function(t,e){var o=[];return(e?t.querySelectorAll("input:checked"):t.querySelectorAll("input:not(:checked)")).forEach(function(t){o.push(parseInt(t.value))}),o},t.prototype.getMarkersToChangeVisibilityFor=function(t,e,o){var i=[];if(0!==this.allMarkers.length)for(var n,r,s=this.getCategoriesOfCheckboxesWithStatus(e,o),a=0;a<this.allMarkers.length;a++)if(0!==(r=(n=this.allMarkers[a]).poiCollection.categories).length){for(var l=void 0,c=0;c<r.length;c++){for(var l=!1,p=0;p<s.length;p++)r[c].uid===s[p]&&(l=!0);if(l===o)break}l&&i.push(n.marker)}return i},t.prototype.showSwitchableCategories=function(t){var e,o,i=this,n=this.groupCategories(t),r=document.createElement("form");for(o in r.classList.add("txMaps2Form"),r.setAttribute("id","txMaps2Form-"+t.contentRecord.uid),n)n.hasOwnProperty(o)&&(r.appendChild(this.getCheckbox(n[o])),null!=(e=r.querySelector("#checkCategory_"+o)))&&e.insertAdjacentHTML("afterend",'<span class="map-category">'.concat(n[o].title,"</span>"));r.querySelectorAll("input").forEach(function(o){o.addEventListener("click",function(){var e=o.checked,t=o.value;i.getMarkersToChangeVisibilityFor(t,r,e).forEach(function(t){e?i.map.addLayer(t):i.map.removeLayer(t)})})}),this.element.insertAdjacentElement("afterend",r)},t.prototype.getCheckbox=function(t){var e=document.createElement("div");return e.classList.add("form-group"),e.innerHTML='\n            <div class="checkbox">\n                <label>\n                    <input type="checkbox" class="checkCategory" id="checkCategory_'.concat(t.uid,'" checked="checked" value="').concat(t.uid,'">\n                </label>\n            </div>'),e},t.prototype.countObjectProperties=function(t){var e,o=0;for(e in t)t.hasOwnProperty(e)&&o++;return o},t.prototype.createPointByCollectionType=function(t){for(var e,o=0;o<this.poiCollections.length;o++){switch(""===this.poiCollections[o].strokeColor&&(this.poiCollections[o].strokeColor=t.extConf.strokeColor),""===this.poiCollections[o].strokeOpacity&&(this.poiCollections[o].strokeOpacity=t.extConf.strokeOpacity),e=null,this.poiCollections[o].collectionType){case"Point":e=this.createMarker(this.poiCollections[o],t);break;case"Area":e=this.createArea(this.poiCollections[o],t);break;case"Route":e=this.createRoute(this.poiCollections[o],t);break;case"Radius":e=this.createRadius(this.poiCollections[o],t)}this.allMarkers.push({marker:e,poiCollection:this.poiCollections[o]});for(var i,n=0;n<this.poiCollections[o].categories.length;n++)i=this.poiCollections[o].categories[n].uid,this.categorizedMarkers.hasOwnProperty(i)||(this.categorizedMarkers[i]=[]),this.categorizedMarkers[i].push(e)}},t.prototype.createMarkerByLatLng=function(t,e){t=L.marker([t,e]).addTo(this.map);this.bounds.extend(t.getLatLng())},t.prototype.inList=function(t,e){return(","+t+",").indexOf(e=","+e+",")},t.prototype.createMarker=function(t,e){var o,i=L.marker([t.latitude,t.longitude],{draggable:this.editable}).addTo(this.map);return t.hasOwnProperty("markerIcon")&&""!==t.markerIcon&&(o=L.icon({iconUrl:t.markerIcon,iconSize:[t.markerIconWidth,t.markerIconHeight],iconAnchor:[t.markerIconAnchorPosX,t.markerIconAnchorPosY]}),i.setIcon(o)),this.bounds.extend(i.getLatLng()),this.editable?this.addEditListeners(this.element,i,t,e):this.addInfoWindow(i,t,e),i},t.prototype.createArea=function(t,e){for(var o=[],i=0;i<t.pois.length;i++){var n=[t.pois[i].latitude,t.pois[i].longitude];this.bounds.extend(n),o.push(n)}var r=L.polygon(o,{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}).addTo(this.map);return this.addInfoWindow(r,t,e),r},t.prototype.createRoute=function(t,e){for(var o=[],i=0;i<t.pois.length;i++){var n=[t.pois[i].latitude,t.pois[i].longitude];this.bounds.extend(n),o.push(n)}var r=L.polyline(o,{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}).addTo(this.map);return this.addInfoWindow(r,t,e),r},t.prototype.createRadius=function(t,e){var o=L.circle([t.latitude,t.longitude],{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity,radius:t.radius}).addTo(this.map);return this.bounds.extend(o.getBounds()),this.addInfoWindow(o,t,e),o},t.prototype.addInfoWindow=function(e,t,o){e.addEventListener("click",function(){fetch(o.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poiCollection:t.uid})}).then(function(t){return t.json()}).then(function(t){e.bindPopup(t.content).openPopup()}).catch(function(t){return console.error("Error:",t)})})},t.prototype.addEditListeners=function(i,n,t,r){n.on("dragend",function(){var t,e=n.getLatLng().lat.toFixed(6),o=n.getLatLng().lng.toFixed(6);null!=(t=i.previousElementSibling)&&t.querySelector("input.latitude-".concat(r.contentRecord.uid)).setAttribute("value",e),null!=(t=i.previousElementSibling)&&t.querySelector("input.longitude-".concat(r.contentRecord.uid)).setAttribute("value",o)}),this.map.on("click",function(t){var e;n.setLatLng(t.latlng),null!=(e=i.previousElementSibling)&&e.querySelector("input.latitude-".concat(r.contentRecord.uid)).setAttribute("value",t.latlng.lat.toFixed(6)),null!=(e=i.previousElementSibling)&&e.querySelector("input.longitude-".concat(r.contentRecord.uid)).setAttribute("value",t.latlng.lng.toFixed(6))})},t.prototype.canBeInterpretedAsNumber=function(t){return"number"==typeof t||!isNaN(Number(t))},t.prototype.getExtConf=function(){return this.environment.extConf},t.prototype.getSettings=function(){return this.environment.settings},t}(),maps2OpenStreetMaps=[];document.querySelectorAll(".maps2").forEach(function(t){var e=void 0!==t.dataset.environment?t.dataset.environment:"{}",o=void 0!==t.dataset.override?t.dataset.override:"{}";maps2OpenStreetMaps.push(new OpenStreetMap2(t,__assign(__assign({},JSON.parse(e)),JSON.parse(o))))});
//# sourceMappingURL=OpenStreetMap2.min.js.map
