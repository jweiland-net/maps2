var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},OpenStreetMap2=function(){function t(t,e){var i;this.element=t,this.environment=e,this.allMarkers=[],this.categorizedMarkers={},this.bounds=new L.LatLngBounds([[e.extConf.defaultLatitude,e.extConf.defaultLongitude]]),this.poiCollections=JSON.parse(this.element.getAttribute("data-pois")||"[]"),this.editable=this.element.classList.contains("editMarker"),this.setWidthAndHeight(),this.createMap(),void 0===this.poiCollections||0===this.poiCollections.length?(t=parseFloat(this.element.getAttribute("data-latitude")||""),i=parseFloat(this.element.getAttribute("data-longitude")||""),isNaN(t)||isNaN(i)||this.createMarkerByLatLng(t,i)):(this.createPointByCollectionType(e),1<this.countObjectProperties(this.categorizedMarkers)&&this.showSwitchableCategories(e),!1===e.settings.forceZoom&&(1<this.poiCollections.length||1===this.poiCollections.length&&("Area"===this.poiCollections[0].collectionType||"Route"===this.poiCollections[0].collectionType))?this.map.fitBounds(this.bounds):this.map.panTo([this.poiCollections[0].latitude,this.poiCollections[0].longitude]))}return t.prototype.setWidthAndHeight=function(){var t=String(this.environment.settings.mapHeight),e=(this.canBeInterpretedAsNumber(t)&&(t+="px"),String(this.environment.settings.mapWidth));this.canBeInterpretedAsNumber(e)&&(e+="px"),this.element.style.height=t,this.element.style.width=e},t.prototype.createMap=function(){this.map=L.map(this.element,{center:[this.getExtConf().defaultLatitude,this.getExtConf().defaultLongitude],zoom:this.getSettings().zoom?this.getSettings().zoom:12,editable:this.editable,scrollWheelZoom:"0"!==this.getSettings().activateScrollWheel}),L.tileLayer(this.getSettings().mapTile,{attribution:this.getSettings().mapTileAttribution,maxZoom:20}).addTo(this.map)},t.prototype.groupCategories=function(t){for(var e,i={},o=0;o<this.poiCollections.length;o++)for(var n=0;n<this.poiCollections[o].categories.length;n++)e=String(this.poiCollections[o].categories[n].uid),-1<this.inList(t.settings.categories,e)&&!i.hasOwnProperty(e)&&(i[e]=this.poiCollections[o].categories[n]);return i},t.prototype.getCategoriesOfCheckboxesWithStatus=function(t,e){var i=[];return(e?t.querySelectorAll("input:checked"):t.querySelectorAll("input:not(:checked)")).forEach(function(t){i.push(parseInt(t.value))}),i},t.prototype.getMarkersToChangeVisibilityFor=function(t,e,i){var o=[];if(0!==this.allMarkers.length)for(var n,r,s=this.getCategoriesOfCheckboxesWithStatus(e,i),a=0;a<this.allMarkers.length;a++)if(0!==(r=(n=this.allMarkers[a]).poiCollection.categories).length){for(var l=void 0,c=0;c<r.length;c++){for(var l=!1,p=0;p<s.length;p++)r[c].uid===s[p]&&(l=!0);if(l===i)break}l&&o.push(n.marker)}return o},t.prototype.showSwitchableCategories=function(t){var e,i,o=this,n=this.groupCategories(t),r=document.createElement("form");for(i in r.classList.add("txMaps2Form"),r.setAttribute("id","txMaps2Form-"+t.contentRecord.uid),n)n.hasOwnProperty(i)&&(r.appendChild(this.getCheckbox(n[i])),null!=(e=r.querySelector("#checkCategory_"+i)))&&e.insertAdjacentHTML("afterend",'<span class="map-category">'.concat(n[i].title,"</span>"));r.querySelectorAll("input").forEach(function(i){i.addEventListener("click",function(){var e=i.checked,t=i.value;o.getMarkersToChangeVisibilityFor(t,r,e).forEach(function(t){e?o.map.addLayer(t):o.map.removeLayer(t)})})}),this.element.insertAdjacentElement("afterend",r)},t.prototype.getCheckbox=function(t){var e=document.createElement("div");return e.classList.add("form-group"),e.innerHTML='\n            <div class="checkbox">\n                <label>\n                    <input type="checkbox" class="checkCategory" id="checkCategory_'.concat(t.uid,'" checked="checked" value="').concat(t.uid,'">\n                </label>\n            </div>'),e},t.prototype.countObjectProperties=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},t.prototype.createPointByCollectionType=function(t){for(var e,i=0;i<this.poiCollections.length;i++){switch(""===this.poiCollections[i].strokeColor&&(this.poiCollections[i].strokeColor=t.extConf.strokeColor),""===this.poiCollections[i].strokeOpacity&&(this.poiCollections[i].strokeOpacity=t.extConf.strokeOpacity),e=null,this.poiCollections[i].collectionType){case"Point":e=this.createMarker(this.poiCollections[i],t);break;case"Area":e=this.createArea(this.poiCollections[i],t);break;case"Route":e=this.createRoute(this.poiCollections[i],t);break;case"Radius":e=this.createRadius(this.poiCollections[i],t)}this.allMarkers.push({marker:e,poiCollection:this.poiCollections[i]});for(var o,n=0;n<this.poiCollections[i].categories.length;n++)o=this.poiCollections[i].categories[n].uid,this.categorizedMarkers.hasOwnProperty(o)||(this.categorizedMarkers[o]=[]),this.categorizedMarkers[o].push(e)}},t.prototype.createMarkerByLatLng=function(t,e){t=L.marker([t,e]).addTo(this.map);this.bounds.extend(t.getLatLng())},t.prototype.inList=function(t,e){return(","+t+",").indexOf(e=","+e+",")},t.prototype.createMarker=function(t,e){var i,o=L.marker([t.latitude,t.longitude],{draggable:this.editable}).addTo(this.map);return t.hasOwnProperty("markerIcon")&&""!==t.markerIcon&&(i=L.icon({iconUrl:t.markerIcon,iconSize:[t.markerIconWidth,t.markerIconHeight],iconAnchor:[t.markerIconAnchorPosX,t.markerIconAnchorPosY]}),o.setIcon(i)),this.bounds.extend(o.getLatLng()),this.editable?this.addEditListeners(this.element,o,t,e):this.addInfoWindow(o,t,e),o},t.prototype.createArea=function(t,e){for(var i=[],o=0;o<t.pois.length;o++){var n=[t.pois[o].latitude,t.pois[o].longitude];this.bounds.extend(n),i.push(n)}var r=L.polygon(i,{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}).addTo(this.map);return this.addInfoWindow(r,t,e),r},t.prototype.createRoute=function(t,e){for(var i=[],o=0;o<t.pois.length;o++){var n=[t.pois[o].latitude,t.pois[o].longitude];this.bounds.extend(n),i.push(n)}var r=L.polyline(i,{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}).addTo(this.map);return this.addInfoWindow(r,t,e),r},t.prototype.createRadius=function(t,e){var i=L.circle([t.latitude,t.longitude],{color:t.strokeColor,opacity:t.strokeOpacity,weight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity,radius:t.radius}).addTo(this.map);return this.bounds.extend(i.getBounds()),this.addInfoWindow(i,t,e),i},t.prototype.addInfoWindow=function(e,t,i){e.addEventListener("click",function(){fetch(i.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poiCollection:t.uid})}).then(function(t){return t.json()}).then(function(t){e.bindPopup(t.content).openPopup()}).catch(function(t){return console.error("Error:",t)})})},t.prototype.addEditListeners=function(o,n,t,r){n.on("dragend",function(){var t,e=n.getLatLng().lat.toFixed(6),i=n.getLatLng().lng.toFixed(6);null!=(t=o.previousElementSibling)&&t.querySelector("input.latitude-".concat(r.contentRecord.uid)).setAttribute("value",e),null!=(t=o.previousElementSibling)&&t.querySelector("input.longitude-".concat(r.contentRecord.uid)).setAttribute("value",i)}),this.map.on("click",function(t){var e;n.setLatLng(t.latlng),null!=(e=o.previousElementSibling)&&e.querySelector("input.latitude-".concat(r.contentRecord.uid)).setAttribute("value",t.latlng.lat.toFixed(6)),null!=(e=o.previousElementSibling)&&e.querySelector("input.longitude-".concat(r.contentRecord.uid)).setAttribute("value",t.latlng.lng.toFixed(6))})},t.prototype.canBeInterpretedAsNumber=function(t){return"number"==typeof t||!isNaN(Number(t))},t.prototype.getExtConf=function(){return this.environment.extConf},t.prototype.getSettings=function(){return this.environment.settings},t}(),maps2OpenStreetMaps=[];document.querySelectorAll(".maps2").forEach(function(t){var e=void 0!==t.dataset.environment?t.dataset.environment:"{}",i=void 0!==t.dataset.override?t.dataset.override:"{}";maps2OpenStreetMaps.push(new OpenStreetMap2(t,__assign(__assign({},JSON.parse(e)),JSON.parse(i))))});
//# sourceMappingURL=OpenStreetMap2.min.js.map
