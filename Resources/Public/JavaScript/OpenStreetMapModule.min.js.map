{"version":3,"sources":["OpenStreetMapModule.js"],"names":["ExtConf","PoiCollection","FormEngine","OpenStreetMapModule","use strict","element","map","constructor","this","document","querySelector","let","extConf","JSON","parse","dataset","poiCollection","marker","createMap","collectionType","createMarker","createArea","createRoute","createRadius","findAddress","latitude","longitude","panTo","defaultLatitude","defaultLongitude","addEventListener","invalidateSize","L","editable","setView","tileLayer","location","protocol","maxZoom","attribution","id","addTo","osm","draggable","on","setLatLngFields","getLatLng","lat","toFixed","lng","event","setLatLng","latlng","area","coordinatesArray","options","color","strokeColor","weight","strokeWeight","opacity","strokeOpacity","fillColor","fillOpacity","configurationMap","i","length","push","editTools","startPolygon","polygon","enableEdit","target","getCenter","storeRouteAsJson","getLatLngs","route","startPolyline","polyline","circle","radius","defaultRadius","getRadius","rad","address","setFieldValue","parseInt","getUriForCoordinates","coordinates","routeObject","index","getFieldElement","field","buildFieldName","uid","value","$fieldElement","val","triggerHandler","stringify","keyCode","preventDefault","fetch","encodeURI","method","headers","Content-Type","then","response","json","data","alert","parseFloat","lon","formattedAddress","getFormattedAddress","editor","updateResizeLatLng","reset","catch","error","console","city","hasOwnProperty","road","houseNumber","postcode","village","town","country"],"mappings":"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","file":"OpenStreetMapModule.min.js","sourcesContent":["import { ExtConf, PoiCollection } from '@jweiland/maps2/Classes.js';\nimport FormEngine from \"@typo3/backend/form-engine.js\";\n\nclass OpenStreetMapModule {\n  \"use strict\"\n\n  /**\n   * @type {HTMLElement}\n   */\n  element = {};\n\n  /**\n   * @type {L.Map}\n   */\n  map = {};\n\n  constructor() {\n    this.element = document.querySelector(\"#maps2ConfigurationMap\");\n\n    /**\n     * @type {ExtConf}\n     */\n    let extConf = new ExtConf(JSON.parse(this.element.dataset.extConf));\n\n    /**\n     * @type {PoiCollection}\n     */\n    let poiCollection = new PoiCollection(JSON.parse(this.element.dataset.poiCollection));\n\n    /**\n     * @type {L.Marker}\n     */\n    let marker = {};\n\n    this.createMap();\n\n    switch (poiCollection.collectionType) {\n      case \"Point\":\n        marker = this.createMarker(poiCollection);\n        break;\n      case \"Area\":\n        this.createArea(poiCollection, extConf);\n        break;\n      case \"Route\":\n        this.createRoute(poiCollection, extConf);\n        break;\n      case \"Radius\":\n        marker = this.createRadius(poiCollection, extConf);\n        break;\n    }\n\n    this.findAddress(poiCollection, marker);\n\n    if (poiCollection.latitude && poiCollection.longitude) {\n      this.map.panTo([poiCollection.latitude, poiCollection.longitude]);\n    } else {\n      // Fallback\n      this.map.panTo([extConf.defaultLatitude, extConf.defaultLongitude]);\n    }\n\n    // If maps2 was inserted in (bootstrap) tabs, we have to re-render the map\n    document.querySelector(\"ul.t3js-tabs li:nth-of-type(2) a[data-bs-toggle='tab']\").addEventListener(\"shown.bs.tab\", () => {\n      this.map.invalidateSize();\n      if (poiCollection.latitude && poiCollection.longitude) {\n        this.map.panTo([poiCollection.latitude, poiCollection.longitude]);\n      } else {\n        // Fallback\n        this.map.panTo([extConf.defaultLatitude, extConf.defaultLongitude]);\n      }\n    });\n  }\n\n  createMap = () => {\n    this.map = L.map(\n      this.element,\n      {\n        editable: true\n      }).setView([51.505, -0.09], 15);\n\n    L.tileLayer(location.protocol + \"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n      maxZoom: 18,\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +  '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' + 'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n      id: \"mapbox.streets\"\n    }).addTo(this.map);\n  };\n\n  createMarker = poiCollection => {\n    let osm = this;\n    let marker = L.marker(\n      [poiCollection.latitude, poiCollection.longitude],\n      {\n        \"draggable\": true\n      }\n    ).addTo(this.map);\n\n    // update fields and marker while dragging\n    marker.on(\"dragend\", () => {\n      osm.setLatLngFields(\n        poiCollection,\n        marker.getLatLng().lat.toFixed(6),\n        marker.getLatLng().lng.toFixed(6),\n        0\n      );\n    });\n\n    // update fields and marker when clicking on the map\n    this.map.on(\"click\", event => {\n      marker.setLatLng(event.latlng);\n      osm.setLatLngFields(\n        poiCollection,\n        event.latlng.lat.toFixed(6),\n        event.latlng.lng.toFixed(6),\n        0\n      );\n    });\n\n    return marker;\n  };\n\n  createArea = (poiCollection, extConf) => {\n    let osm = this;\n    let area = {};\n    let coordinatesArray = [];\n    let options = {\n      color: extConf.strokeColor,\n      weight: extConf.strokeWeight,\n      opacity: extConf.strokeOpacity,\n      fillColor: extConf.fillColor,\n      fillOpacity: extConf.fillOpacity\n    };\n\n    if (poiCollection.configurationMap) {\n      for (let i = 0; i < poiCollection.configurationMap.length; i++) {\n        coordinatesArray.push([\n          poiCollection.configurationMap[i].latitude,\n          poiCollection.configurationMap[i].longitude]\n        );\n      }\n    }\n\n    if (coordinatesArray.length === 0) {\n      area = this.map.editTools.startPolygon(null, options);\n    } else {\n      area = L.polygon(coordinatesArray, options).addTo(this.map);\n      area.enableEdit();\n    }\n\n    this.map.on(\"moveend\", event => {\n      osm.setLatLngFields(\n        poiCollection,\n        event.target.getCenter().lat.toFixed(6),\n        event.target.getCenter().lng.toFixed(6),\n        0\n      );\n    });\n    this.map.on(\"editable:vertex:new\", event => {\n      osm.storeRouteAsJson(poiCollection, area.getLatLngs()[0]);\n    });\n    this.map.on(\"editable:vertex:deleted\", event => {\n      osm.storeRouteAsJson(poiCollection, area.getLatLngs()[0]);\n    });\n    this.map.on(\"editable:vertex:dragend\", event => {\n      osm.storeRouteAsJson(poiCollection, area.getLatLngs()[0]);\n    });\n  };\n\n  createRoute = (poiCollection, extConf) => {\n    let osm = this;\n    let route = {};\n    let coordinatesArray = [];\n    let options = {\n      color: extConf.strokeColor,\n      weight: extConf.strokeWeight,\n      opacity: extConf.strokeOpacity\n    };\n\n    if (poiCollection.configurationMap) {\n      for (let i = 0; i < poiCollection.configurationMap.length; i++) {\n        coordinatesArray.push([\n          poiCollection.configurationMap[i].latitude,\n          poiCollection.configurationMap[i].longitude]\n        );\n      }\n    }\n\n    if (coordinatesArray.length === 0) {\n      route = this.map.editTools.startPolyline(null, options);\n    } else {\n      route = L.polyline(coordinatesArray, options).addTo(this.map);\n      route.enableEdit();\n    }\n\n    this.map.on(\"moveend\", event => {\n      osm.setLatLngFields(\n        poiCollection,\n        event.target.getCenter().lat.toFixed(6),\n        event.target.getCenter().lng.toFixed(6),\n        0\n      );\n    });\n    this.map.on(\"editable:vertex:new\", event => {\n      osm.storeRouteAsJson(poiCollection, route.getLatLngs());\n    });\n    this.map.on(\"editable:vertex:deleted\", event => {\n      osm.storeRouteAsJson(poiCollection, route.getLatLngs());\n    });\n    this.map.on(\"editable:vertex:dragend\", event => {\n      osm.storeRouteAsJson(poiCollection, route.getLatLngs());\n    });\n  };\n\n  createRadius = (poiCollection, extConf) => {\n    let osm = this;\n    let marker = L.circle(\n      [poiCollection.latitude, poiCollection.longitude],\n      {\n        color: extConf.strokeColor,\n        opacity: extConf.strokeOpacity,\n        weight: extConf.strokeWeight,\n        fillColor: extConf.fillColor,\n        fillOpacity: extConf.fillOpacity,\n        radius: poiCollection.radius ? poiCollection.radius : extConf.defaultRadius\n      }\n    ).addTo(this.map);\n\n    let editor = marker.enableEdit();\n\n    // Update fields and marker while dragging\n    marker.on(\"editable:dragend editable:vertex:dragend\", event => {\n      osm.setLatLngFields(\n        poiCollection,\n        marker.getLatLng().lat.toFixed(6),\n        marker.getLatLng().lng.toFixed(6),\n        marker.getRadius()\n      );\n    });\n\n    return marker;\n  };\n\n  /**\n   * Fill TCA fields for Lat and Lng with value of marker position\n   *\n   * @param number lat\n   * @param number lng\n   * @param number rad\n   * @param string address\n   */\n  setLatLngFields = (poiCollection, lat, lng, rad, address) => {\n    this.setFieldValue(poiCollection, \"latitude\", lat);\n    this.setFieldValue(poiCollection, \"longitude\", lng);\n\n    if (typeof rad !== \"undefined\" && rad > 0) {\n      this.setFieldValue(poiCollection, \"radius\", parseInt(rad));\n    }\n\n    if (typeof address !== \"undefined\") {\n      this.setFieldValue(poiCollection, \"address\", address);\n    }\n  };\n\n  /**\n   * Generate an uri to save all coordinates\n   *\n   * @param {array} coordinates\n   * @return {object}\n   */\n  getUriForCoordinates = coordinates => {\n    let routeObject = {};\n\n    for (let index = 0; index < coordinates.length; index++) {\n      routeObject[index] = coordinates[index][\"lat\"] + \",\" + coordinates[index][\"lng\"];\n    }\n\n    return routeObject;\n  };\n\n  /**\n   * Return FieldElement from TCEFORM by fieldName\n   *\n   * @param field\n   * @returns {*|HTMLElement} jQuery object. FormEngine works with $ selectors\n   */\n  getFieldElement = (poiCollection, field) => {\n    // Return the FieldElement which is visible to the editor\n    return FormEngine.getFieldElement(this.buildFieldName(poiCollection, field), \"_list\");\n  };\n\n  /**\n   * Build fieldName like \"data[tx_maps2_domain_model_poicollection][1][latitude]\"\n   *\n   * @param poiCollection\n   * @param field\n   * @returns {string}\n   */\n  buildFieldName = (poiCollection, field) => {\n    return \"data[tx_maps2_domain_model_poicollection][\" + poiCollection.uid + \"][\" + field + \"]\";\n  };\n\n  /**\n   * Set field value\n   *\n   * @param {PoiCollection} poiCollection\n   * @param {string} field\n   * @param {string | number} value\n   */\n  setFieldValue = (poiCollection, field, value) => {\n    let $fieldElement = this.getFieldElement(poiCollection, field);\n    if ($fieldElement && $fieldElement.length) {\n      $fieldElement.val(value);\n      $fieldElement.triggerHandler(\"change\");\n    }\n  };\n\n  /**\n   * Store route/area path into configurationMap as JSON\n   *\n   * @param {PoiCollection} poiCollection\n   * @param coordinates\n   */\n  storeRouteAsJson = (poiCollection, coordinates) => {\n    this.setFieldValue(\n      poiCollection,\n      \"configuration_map\",\n      JSON.stringify(this.getUriForCoordinates(coordinates))\n    );\n  };\n\n  /**\n   * read address, send it to OpenStreetMap and move map/marker to new location\n   */\n  findAddress = (poiCollection, marker) => {\n    let osm = this;\n    let pacSearch = document.querySelector(\"#pac-search\");\n\n    // Prevent submitting the BE form on enter\n    pacSearch.addEventListener(\"keydown\", event => {\n      if (event.keyCode === 13 && event.target.value) {\n        event.preventDefault();\n        fetch(\"https://nominatim.openstreetmap.org/search?q=\" + encodeURI(event.target.value) + \"&format=json&addressdetails=1\", {\n          method: \"GET\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          }\n        })\n          .then(response => response.json())\n          .then(data => {\n            if (data.length === 0) {\n              alert(\"Address not found\");\n            } else {\n              let lat = parseFloat(data[0].lat).toFixed(6);\n              let lng = parseFloat(data[0].lon).toFixed(6);\n              let address = data[0].address;\n              let formattedAddress = osm.getFormattedAddress(address);\n\n              switch (poiCollection.collectionType) {\n                case \"Point\":\n                  marker.setLatLng([lat, lng]);\n                  osm.setLatLngFields(poiCollection, lat, lng, 0, formattedAddress);\n                  break;\n                case \"Area\":\n                  osm.setLatLngFields(poiCollection, lat, lng, 0, formattedAddress);\n                  break;\n                case \"Route\":\n                  osm.setLatLngFields(poiCollection, lat, lng, 0, formattedAddress);\n                  break;\n                case \"Radius\":\n                  marker.setLatLng([lat, lng]);\n                  marker.editor.updateResizeLatLng();\n                  marker.editor.reset();\n                  osm.setLatLngFields(poiCollection, lat, lng, marker.getRadius(), formattedAddress);\n                  break;\n              }\n\n              osm.map.panTo([lat, lng]);\n            }\n          })\n          .catch(error => console.error('Error:', error));\n\n        return false;\n      }\n    });\n  };\n\n  /**\n   * format address from ajax result\n   *\n   * @param address\n   * @returns {string}\n   */\n  getFormattedAddress = address => {\n    let formattedAddress = \"\";\n    let city = \"\";\n\n    if (address.hasOwnProperty(\"road\")) {\n      formattedAddress += address.road;\n    }\n    if (address.hasOwnProperty(\"houseNumber\")) {\n      formattedAddress += \" \" + address.houseNumber;\n    }\n    if (address.hasOwnProperty(\"postcode\")) {\n      formattedAddress += \", \" + address.postcode;\n    }\n\n    if (address.hasOwnProperty(\"village\")) {\n      city = address.village;\n    }\n    if (address.hasOwnProperty(\"town\")) {\n      city = address.town;\n    }\n    if (address.hasOwnProperty(\"city\")) {\n      city = address.city;\n    }\n    formattedAddress += \" \" + city;\n\n    if (address.hasOwnProperty(\"country\")) {\n      formattedAddress += \", \" + address.country;\n    }\n\n    return formattedAddress;\n  };\n}\n\nexport default new OpenStreetMapModule();\n"]}