class GoogleMaps2{allMarkers=[];categorizedMarkers={};pointMarkers=[];bounds={};infoWindow={};poiCollections={};editable={};map={};constructor(e,t){var o,i;this.allMarkers=[],this.categorizedMarkers={},this.pointMarkers=[],this.bounds=new google.maps.LatLngBounds,this.infoWindow=new google.maps.InfoWindow,this.poiCollections=JSON.parse(e.dataset.pois||"null"),this.editable=e.classList.contains("editMarker"),this.setMapDimensions(e,t.settings),this.createMap(e,t),void 0===this.poiCollections||null===this.poiCollections?(o=Number(e.dataset.latitude),i=Number(e.dataset.longitude),o&&i?(this.createMarkerByLatLng(o,i),this.map.setCenter(new google.maps.LatLng(o,i))):this.map.setCenter(new google.maps.LatLng(t.extConf.defaultLatitude,t.extConf.defaultLongitude))):(this.createPointByCollectionType(e,t),void 0!==t.settings.markerClusterer&&1===t.settings.markerClusterer.enable&&new MarkerClusterer(this.map,this.pointMarkers,{imagePath:t.settings.markerClusterer.imagePath}),1<this.countObjectProperties(this.categorizedMarkers)&&this.showSwitchableCategories(e,t),this.shouldFitBounds(t.settings)?this.map.fitBounds(this.bounds):this.map.setCenter(new google.maps.LatLng(this.poiCollections[0].latitude,this.poiCollections[0].longitude)))}getMapOptions=settings=>{let mapOptions={mapTypeId:"",zoom:parseInt(settings.zoom),zoomControl:0!==parseInt(settings.zoomControl),mapTypeControl:0!==parseInt(settings.mapTypeControl),scaleControl:0!==parseInt(settings.scaleControl),streetViewControl:0!==parseInt(settings.streetViewControl),fullscreenControl:0!==parseInt(settings.fullScreenControl),scrollwheel:settings.activateScrollWheel,styles:""};switch(settings.styles&&(mapOptions.styles=eval(settings.styles)),settings.mapTypeId){case"google.maps.MapTypeId.HYBRID":case"hybrid":mapOptions.mapTypeId=google.maps.MapTypeId.HYBRID;break;case"google.maps.MapTypeId.ROADMAP":case"roadmap":mapOptions.mapTypeId=google.maps.MapTypeId.ROADMAP;break;case"google.maps.MapTypeId.SATELLITE":case"satellite":mapOptions.mapTypeId=google.maps.MapTypeId.SATELLITE;break;case"google.maps.MapTypeId.TERRAIN":case"terrain":mapOptions.mapTypeId=google.maps.MapTypeId.TERRAIN}return mapOptions};getCircleOptions(e,t,o){return{map:e,center:t,radius:o.radius,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight,fillColor:o.fillColor,fillOpacity:o.fillOpacity}}getPolygonOptions(e,t){return{paths:e,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}}getPolylineOptions(e,t){return{path:e,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight}}createMap(e,t){this.map=new google.maps.Map(e,this.getMapOptions(t.settings))}canBeInterpretedAsNumber(e){return"number"==typeof e||!isNaN(Number(e))}normalizeDimension(e){let t=String(e);return this.canBeInterpretedAsNumber(t)&&(t+="px"),t}shouldFitBounds(e){return!0!==e.forceZoom&&null!==this.poiCollections&&(1<this.poiCollections.length||1===this.poiCollections.length&&("Area"===this.poiCollections[0].collectionType||"Route"===this.poiCollections[0].collectionType))}setMapDimensions(e,t){e.style.height=this.normalizeDimension(t.mapHeight),e.style.width=this.normalizeDimension(t.mapWidth)}groupCategories=o=>{var i,s={};for(let t=0;t<this.poiCollections.length;t++)for(let e=0;e<this.poiCollections[t].categories.length;e++)i=String(this.poiCollections[t].categories[e].uid),-1<this.inList(o.settings.categories,i)&&!s.hasOwnProperty(i)&&(s[i]=this.poiCollections[t].categories[e]);return s};getCategoriesOfCheckboxesWithStatus=(e,t)=>{let o=[];return(t?e.querySelectorAll("input:checked"):e.querySelectorAll("input:not(input:checked)")).forEach(e=>{o.push(parseInt(e.value))}),o};getMarkersToChangeVisibilityFor=(e,t,i)=>{var s=[];if(0!==this.allMarkers.length){var r,a,n=this.getCategoriesOfCheckboxesWithStatus(t,i);for(let e=0;e<this.allMarkers.length;e++)if(0!==(a=(r=this.allMarkers[e]).poiCollection.categories).length){let o;for(let t=0;t<a.length;t++){o=!1;for(let e=0;e<n.length;e++)a[t].uid===n[e]&&(o=!0);if(o===i)break}o&&s.push(r.marker)}}return s};showSwitchableCategories=(e,t)=>{var o=this.groupCategories(t);let i=document.createElement("form");for(var s in i.classList.add("txMaps2Form"),i.setAttribute("id","txMaps2Form-"+t.contentRecord.uid),o)o.hasOwnProperty(s)&&(i.appendChild(this.getCheckbox(o[s])),i.querySelector("#checkCategory_"+s)?.insertAdjacentHTML("afterend",`<span class="map-category">${o[s].title}</span>`));i.querySelectorAll("input").forEach(o=>{o.addEventListener("click",()=>{let t=o.checked;var e=o.value;this.getMarkersToChangeVisibilityFor(e,i,t).forEach(e=>{e.setVisible(t)})})}),e.insertAdjacentElement("afterend",i)};getCheckbox(e){var t=document.createElement("div");return t.classList.add("form-group"),t.innerHTML=`
      <div class="checkbox">
          <label>
              <input type="checkbox" class="checkCategory" id="checkCategory_${e.uid}" checked="checked" value="${e.uid}">
          </label>
      </div>`,t}countObjectProperties=e=>{let t=0;for(var o in e)e.hasOwnProperty(o)&&t++;return t};createPointByCollectionType=(e,o)=>{let i,s=0;null!==this.poiCollections&&this.poiCollections.length&&this.poiCollections.forEach(t=>{switch(""===t.strokeColor&&(t.strokeColor=o.extConf.strokeColor),""===t.strokeOpacity&&(t.strokeOpacity=o.extConf.strokeOpacity),""===t.strokeWeight&&(t.strokeWeight=o.extConf.strokeWeight),""===t.fillColor&&(t.fillColor=o.extConf.fillColor),""===t.fillOpacity&&(t.fillOpacity=o.extConf.fillOpacity),i=null,t.collectionType){case"Point":i=this.createMarker(t,e,o);break;case"Area":i=this.createArea(t,o);break;case"Route":i=this.createRoute(t,o);break;case"Radius":i=this.createRadius(t,o)}if(null!==i){this.allMarkers.push({marker:i,poiCollection:t});for(let e=s=0;e<t.categories.length;e++)s=t.categories[e].uid,this.categorizedMarkers.hasOwnProperty(s)||(this.categorizedMarkers[s]=[]),this.categorizedMarkers[s].push({marker:i,relatedCategories:t.categories})}})};createMarker=(e,t,o)=>{var i,s=new google.maps.Marker({position:new google.maps.LatLng(e.latitude,e.longitude),map:this.map});return s.setDraggable(this.editable),e.hasOwnProperty("markerIcon")&&""!==e.markerIcon&&(i={url:e.markerIcon,scaledSize:new google.maps.Size(e.markerIconWidth,e.markerIconHeight),anchor:new google.maps.Point(e.markerIconAnchorPosX,e.markerIconAnchorPosY)},s.setIcon(i)),this.pointMarkers.push(s),this.bounds.extend(s.position),this.editable?this.addEditListeners(t,s,e,o):this.addInfoWindow(s,e,o),s};createArea=(t,e)=>{var o,i=[];for(let e=0;e<t.pois.length;e++)o=new google.maps.LatLng(t.pois[e].latitude,t.pois[e].longitude),this.bounds.extend(o),i.push(o);0===i.length&&i.push(this.mapPosition);var s=new google.maps.Polygon(this.getPolygonOptions(i,t));return s.setMap(this.map),this.addInfoWindow(s,t,e),s};createRoute=(t,e)=>{var o,i=[];for(let e=0;e<t.pois.length;e++)o=new google.maps.LatLng(t.pois[e].latitude,t.pois[e].longitude),this.bounds.extend(o),i.push(o);0===i.length&&i.push(this.mapPosition);var s=new google.maps.Polyline(this.getPolylineOptions(i,t));return s.setMap(this.map),this.addInfoWindow(s,t,e),s};createRadius=(e,t)=>{var o=new google.maps.Circle(this.getCircleOptions(this.map,new google.maps.LatLng(e.latitude,e.longitude),e));return this.bounds.union(o.getBounds()),this.addInfoWindow(o,e,t),o};addInfoWindow=(t,o,i)=>{let s=this.infoWindow,r=this.map;google.maps.event.addListener(t,"click",e=>{fetch(i.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poiCollection:o.uid})}).then(e=>e.json()).then(e=>{s.close(),s.setContent(e.content),"Point"===o.collectionType?(s.setPosition(null),s.open(r,t)):(s.setPosition(new google.maps.LatLng(o.latitude,o.longitude)),s.open(r))}).catch(e=>console.error("Error:",e))})};inList=(e,t)=>{return(","+e+",").search(t=","+t+",")};createMarkerByLatLng=(e,t)=>{e=new google.maps.Marker({position:new google.maps.LatLng(e,t),map:this.map});this.bounds.extend(e.position)};addEditListeners=(o,i,e,s)=>{google.maps.event.addListener(i,"dragend",()=>{var e=i.getPosition().lat().toFixed(6),t=i.getPosition().lng().toFixed(6);o.prevAll("input.latitude-"+s.contentRecord.uid).val(e),o.prevAll("input.longitude-"+s.contentRecord.uid).val(t)}),google.maps.event.addListener(this.map,"click",e=>{i.setPosition(e.latLng),o.prevAll("input.latitude-"+s.contentRecord.uid).val(e.latLng.lat().toFixed(6)),o.prevAll("input.longitude-"+s.contentRecord.uid).val(e.latLng.lng().toFixed(6))})}}let maps2GoogleMaps=[];function initMap(){document.querySelectorAll(".maps2").forEach(e=>{var t=void 0!==e.dataset.environment?e.dataset.environment:"{}",o=void 0!==e.dataset.override?e.dataset.override:"{}";const n=()=>{let e={},t=!1,o=0;var i=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],o++);o<i;o++){var s,r=arguments[o],a=(s=void 0,r);for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t&&"[object Object]"===Object.prototype.toString.call(a[s])?e[s]=n(!0,e[s],a[s]):e[s]=a[s])}return e};maps2GoogleMaps.push(new GoogleMaps2(e,n(JSON.parse(t),JSON.parse(o))))});var e=document.querySelector("#maps2Address"),t=document.querySelector("#maps2Radius");null!==e&&null!==t&&(new google.maps.places.Autocomplete(e,{fields:["place_id"]}),e.addEventListener("keydown",e=>{if(13===e.keyCode)return!1}))}
//# sourceMappingURL=GoogleMaps2.min.js.map
