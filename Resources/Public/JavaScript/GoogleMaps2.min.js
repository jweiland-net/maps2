class GoogleMaps2{allMarkers=[];categorizedMarkers={};pointMarkers=[];bounds={};infoWindow={};poiCollections={};editable={};map={};constructor(e,t){var o,s;this.allMarkers=[],this.categorizedMarkers={},this.pointMarkers=[],this.bounds=new google.maps.LatLngBounds,this.infoWindow=new google.maps.InfoWindow,this.poiCollections=JSON.parse(e.dataset.pois),this.editable=e.classList.contains("editMarker"),this.setMapDimensions(e,t.settings),this.createMap(e,t),void 0===this.poiCollections?(o=Number(e.dataset.latitude),s=Number(e.dataset.longitude),o&&s?(this.createMarkerByLatLng(o,s),this.map.setCenter(new google.maps.LatLng(o,s))):this.map.setCenter(new google.maps.LatLng(t.extConf.defaultLatitude,t.extConf.defaultLongitude))):(this.createPointByCollectionType(e,t),void 0!==t.settings.markerClusterer&&1===t.settings.markerClusterer.enable&&new MarkerClusterer(this.map,this.pointMarkers,{imagePath:t.settings.markerClusterer.imagePath}),1<this.countObjectProperties(this.categorizedMarkers)&&this.showSwitchableCategories(e,t),!1===t.settings.forceZoom&&(1<this.poiCollections.length||1===this.poiCollections.length&&("Area"===this.poiCollections[0].collectionType||"Route"===this.poiCollections[0].collectionType))?this.map.fitBounds(this.bounds):this.map.setCenter(new google.maps.LatLng(this.poiCollections[0].latitude,this.poiCollections[0].longitude)))}getMapOptions=settings=>{let mapOptions={mapTypeId:"",zoom:parseInt(settings.zoom),zoomControl:0!==parseInt(settings.zoomControl),mapTypeControl:0!==parseInt(settings.mapTypeControl),scaleControl:0!==parseInt(settings.scaleControl),streetViewControl:0!==parseInt(settings.streetViewControl),fullscreenControl:0!==parseInt(settings.fullScreenControl),scrollwheel:settings.activateScrollWheel,styles:""};switch(settings.styles&&(mapOptions.styles=eval(settings.styles)),settings.mapTypeId){case"google.maps.MapTypeId.HYBRID":case"hybrid":mapOptions.mapTypeId=google.maps.MapTypeId.HYBRID;break;case"google.maps.MapTypeId.ROADMAP":case"roadmap":mapOptions.mapTypeId=google.maps.MapTypeId.ROADMAP;break;case"google.maps.MapTypeId.SATELLITE":case"satellite":mapOptions.mapTypeId=google.maps.MapTypeId.SATELLITE;break;case"google.maps.MapTypeId.TERRAIN":case"terrain":mapOptions.mapTypeId=google.maps.MapTypeId.TERRAIN}return mapOptions};getCircleOptions(e,t,o){return{map:e,center:t,radius:o.radius,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight,fillColor:o.fillColor,fillOpacity:o.fillOpacity}}getPolygonOptions(e,t){return{paths:e,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight,fillColor:t.fillColor,fillOpacity:t.fillOpacity}}getPolylineOptions(e,t){return{path:e,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight}}createMap(e,t){this.map=new google.maps.Map(e,this.getMapOptions(t.settings))}canBeInterpretedAsNumber(e){return"number"==typeof e||!isNaN(Number(e))}normalizeDimension(e){let t=String(e);return this.canBeInterpretedAsNumber(t)&&(t+="px"),t}setMapDimensions(e,t){e.style.height=this.normalizeDimension(t.mapHeight),e.style.width=this.normalizeDimension(t.mapWidth)}groupCategories=o=>{var s,i={};for(let t=0;t<this.poiCollections.length;t++)for(let e=0;e<this.poiCollections[t].categories.length;e++)s=String(this.poiCollections[t].categories[e].uid),-1<this.inList(o.settings.categories,s)&&!i.hasOwnProperty(s)&&(i[s]=this.poiCollections[t].categories[e]);return i};getCategoriesOfCheckboxesWithStatus=(e,t)=>{let o=[];return(t?e.querySelectorAll("input:checked"):e.querySelectorAll("input:not(input:checked)")).forEach(e=>{o.push(parseInt(e.value))}),o};getMarkersToChangeVisibilityFor=(e,t,s)=>{var i=[];if(0!==this.allMarkers.length){var a,r,n=this.getCategoriesOfCheckboxesWithStatus(t,s);for(let e=0;e<this.allMarkers.length;e++)if(0!==(r=(a=this.allMarkers[e]).poiCollection.categories).length){let o;for(let t=0;t<r.length;t++){o=!1;for(let e=0;e<n.length;e++)r[t].uid===n[e]&&(o=!0);if(o===s)break}o&&i.push(a.marker)}}return i};showSwitchableCategories=(e,t)=>{var o=this.groupCategories(t);let s=document.createElement("form");for(var i in s.classList.add("txMaps2Form"),s.setAttribute("id","txMaps2Form-"+t.contentRecord.uid),o)o.hasOwnProperty(i)&&(s.appendChild(this.getCheckbox(o[i])),s.querySelector("#checkCategory_"+i)?.insertAdjacentHTML("afterend",`<span class="map-category">${o[i].title}</span>`));s.querySelectorAll("input").forEach(o=>{o.addEventListener("click",()=>{let t=o.checked;var e=o.value;this.getMarkersToChangeVisibilityFor(e,s,t).forEach(e=>{e.setVisible(t)})})}),e.insertAdjacentElement("afterend",s)};getCheckbox(e){var t=document.createElement("div");return t.classList.add("form-group"),t.innerHTML=`
      <div class="checkbox">
          <label>
              <input type="checkbox" class="checkCategory" id="checkCategory_${e.uid}" checked="checked" value="${e.uid}">
          </label>
      </div>`,t}countObjectProperties=e=>{let t=0;for(var o in e)e.hasOwnProperty(o)&&t++;return t};createPointByCollectionType=(e,o)=>{let s,i=0;this.poiCollections.forEach(t=>{switch(""===t.strokeColor&&(t.strokeColor=o.extConf.strokeColor),""===t.strokeOpacity&&(t.strokeOpacity=o.extConf.strokeOpacity),""===t.strokeWeight&&(t.strokeWeight=o.extConf.strokeWeight),""===t.fillColor&&(t.fillColor=o.extConf.fillColor),""===t.fillOpacity&&(t.fillOpacity=o.extConf.fillOpacity),s=null,t.collectionType){case"Point":s=this.createMarker(t,e,o);break;case"Area":s=this.createArea(t,o);break;case"Route":s=this.createRoute(t,o);break;case"Radius":s=this.createRadius(t,o)}if(null!==s){this.allMarkers.push({marker:s,poiCollection:t});for(let e=i=0;e<t.categories.length;e++)i=t.categories[e].uid,this.categorizedMarkers.hasOwnProperty(i)||(this.categorizedMarkers[i]=[]),this.categorizedMarkers[i].push({marker:s,relatedCategories:t.categories})}})};createMarker=(e,t,o)=>{var s,i=new google.maps.Marker({position:new google.maps.LatLng(e.latitude,e.longitude),map:this.map});return i.setDraggable(this.editable),e.hasOwnProperty("markerIcon")&&""!==e.markerIcon&&(s={url:e.markerIcon,scaledSize:new google.maps.Size(e.markerIconWidth,e.markerIconHeight),anchor:new google.maps.Point(e.markerIconAnchorPosX,e.markerIconAnchorPosY)},i.setIcon(s)),this.pointMarkers.push(i),this.bounds.extend(i.position),this.editable?this.addEditListeners(t,i,e,o):this.addInfoWindow(i,e,o),i};createArea=(t,e)=>{var o,s=[];for(let e=0;e<t.pois.length;e++)o=new google.maps.LatLng(t.pois[e].latitude,t.pois[e].longitude),this.bounds.extend(o),s.push(o);0===s.length&&s.push(this.mapPosition);var i=new google.maps.Polygon(this.getPolygonOptions(s,t));return i.setMap(this.map),this.addInfoWindow(i,t,e),i};createRoute=(t,e)=>{var o,s=[];for(let e=0;e<t.pois.length;e++)o=new google.maps.LatLng(t.pois[e].latitude,t.pois[e].longitude),this.bounds.extend(o),s.push(o);0===s.length&&s.push(this.mapPosition);var i=new google.maps.Polyline(this.getPolylineOptions(s,t));return i.setMap(this.map),this.addInfoWindow(i,t,e),i};createRadius=(e,t)=>{var o=new google.maps.Circle(this.getCircleOptions(this.map,new google.maps.LatLng(e.latitude,e.longitude),e));return this.bounds.union(o.getBounds()),this.addInfoWindow(o,e,t),o};addInfoWindow=(t,o,s)=>{let i=this.infoWindow,a=this.map;google.maps.event.addListener(t,"click",e=>{fetch(s.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poiCollection:o.uid})}).then(e=>e.json()).then(e=>{i.close(),i.setContent(e.content),"Point"===o.collectionType?(i.setPosition(null),i.open(a,t)):(i.setPosition(new google.maps.LatLng(o.latitude,o.longitude)),i.open(a))}).catch(e=>console.error("Error:",e))})};inList=(e,t)=>{return(","+e+",").search(t=","+t+",")};createMarkerByLatLng=(e,t)=>{e=new google.maps.Marker({position:new google.maps.LatLng(e,t),map:this.map});this.bounds.extend(e.position)};addEditListeners=(o,s,e,i)=>{google.maps.event.addListener(s,"dragend",()=>{var e=s.getPosition().lat().toFixed(6),t=s.getPosition().lng().toFixed(6);o.prevAll("input.latitude-"+i.contentRecord.uid).val(e),o.prevAll("input.longitude-"+i.contentRecord.uid).val(t)}),google.maps.event.addListener(this.map,"click",e=>{s.setPosition(e.latLng),o.prevAll("input.latitude-"+i.contentRecord.uid).val(e.latLng.lat().toFixed(6)),o.prevAll("input.longitude-"+i.contentRecord.uid).val(e.latLng.lng().toFixed(6))})}}let maps2GoogleMaps=[];function initMap(){document.querySelectorAll(".maps2").forEach(e=>{var t=void 0!==e.dataset.environment?e.dataset.environment:"{}",o=void 0!==e.dataset.override?e.dataset.override:"{}";maps2GoogleMaps.push(new GoogleMaps2(e,{...JSON.parse(t),...JSON.parse(o)}))});var e=document.querySelector("#maps2Address"),t=document.querySelector("#maps2Radius");null!==e&&null!==t&&(new google.maps.places.Autocomplete(e,{fields:["place_id"]}),e.addEventListener("keydown",e=>{if(13===e.keyCode)return!1}))}
//# sourceMappingURL=GoogleMaps2.min.js.map
